{
	"$defs": {
		"audioEvent": {
			"pattern": "^event:(?:\/[A-Za-z0-9_]+)+$",
			"type": "string"
		},

		"mapMetadata": {
			"properties": {
				"AudioState": {
					"properties": {
						"Ambience": { "$ref": "#/$defs/audioEvent" },
						"Music": { "$ref": "#/$defs/audioEvent" }
					},
					"required": ["Music", "Ambience"],
					"type": "object"
				},

				"HeartIsEnd": {
					"description": "Whether collecting the crystal heart ends this map.",
					"type": "boolean"
				},

				"Inventory": {
					"description": "Determines dash count and dream block activation.",
					"enum": ["Default"],
					"type": "string"
				},

				"SeekerSlowdown": {
					"default": false,
					"description": "Whether time slows down when seekers get close to the player.",
					"type": "boolean"
				}
			},
			"required": ["AudioState", "Inventory", "SeekerSlowdown"],
			"type": "object"
		},

		"ray3d": {
			"properties": {
				"Position": { "$ref": "#/$defs/vector3" },
				"Target": { "$ref": "#/$defs/vector3" }
			},
			"required": ["Position", "Target"],
			"type": "object"
		},

		"screenDefinition": {
			"Atlas": {
				"description": "Atlas to use for this screen.",
				"type": "string"
			},

			"Center": { "$ref": "#/$defs/vector2" },
			"Layers": {
				"items": {
					"properties": {
						"Alpha": {
							"maximum": 1,
							"minimum": 0,
							"type": "number"
						},
						"Images": {
							"items": { "type": "string" },
							"type": "array"
						},
						"Position": { "$ref": "#/$defs/vector2" },
						"Scale": { "type": "number" },
						"Scroll": {
							"items": { "type": "number" },
							"minItems": 1,
							"type": "array"
						},
						"Speed": { "$ref": "#/$defs/vector2" },
						"Type": {
							"enum": ["layer", "ui"],
							"type": "string"
						}
					},
					"required": ["Type"],
					"type": "object"
				},
				"type": "array"
			},
			"Start": { "$ref": "#/$defs/vector2" }
		},
		"vector2": {
			"items": {
				"type": "number"
			},
			"maxItems": 2,
			"minItems": 2,
			"type": "array"
		},

		"vector3": {
			"items": {
				"type": "number"
			},
			"maxItems": 3,
			"minItems": 3,
			"type": "array"
		}
	},
	"$schema": "https://json-schema.org/draft/2020-12/schema",
	"description": "Describes map metadata.",

	"properties": {
		"BloomBase": {
			"description": "Base bloom value. Influences how much bloom is emitted from geometry.",
			"minimum": 0,
			"type": "number"
		},

		"BloomStrength": {
			"description": "Strength of bloom effect. Effectively a multiplier for the bloom value.",
			"minimum": 0,
			"type": "number"
		},

		"CassetteCheckpointIndex": {
			"deprecated": true,
			"description": "Automatically determined by Everest.",
			"minimum": 0,
			"type": "integer"
		},

		"CassetteNoteColor": {
			"type": "string"
		},

		"CassetteSong": { "$ref": "#/$defs/audioEvent" },

		"ColorGrade": {
			"description": "Color grade for this map.",
			"type": "string"
		},

		"CompleteScreen": { "$ref": "#/$defs/screenDefinition" },
		"CoreMode": {
			"description": "Core mode this map starts on.",
			"enum": ["Hot", "Cold"],
			"type": "string"
		},

		"DarknessAlpha": {
			"description": "Alpha value for darkness overlay. ",
			"maximum": 1,
			"minimum": 0,
			"type": "number"
		},

		"Dreaming": {
			"description": "Whether this map is a dream map.",
			"type": "boolean"
		},

		"Icon": {
			"description": "Icon for this chapter in the menu.",
			"type": "string"
		},

		"Interlude": {
			"description": "Whether this chapter is an interlude chapter. Interlude chapters have no chapter number, strawberries, death counts, nor sides.",
			"type": "boolean"
		},

		"IntroType": {
			"description": "Descriptor for how Player object should behave on map start.",
			"enum": ["WalkInRight", "Jump", "WakeUp"],
			"type": "string"
		},

		"Jumpthru": {
			"deprecated": true,
			"description": "Style of jumpthrus on this map. Not needed by custom maps.",
			"type": "string"
		},

		"LoadingVignetteScreen": { "$ref": "#/$defs/screenDefinition" },
		"LoadingVignetteText": {
			"properties": {
				"Dialog": {
					"description": "ID of dialog to display on the loading vignette. Used for Intro and 8A.",
					"type": "string"
				}
			},
			"type": "object"
		},

		"Modes": {
			"description": "Metadata for A-, B-, and C-side, respectively.",
			"item": { "$ref": "#/$defs/mapMetadata" },
			"maximum": 3,
			"minimum": 1,
			"type": "array"
		},

		"Mountain": {
			"description": "Definitions for how the 3D viewport in the menu should appear.",
			"properties": {
				"Cursor": { "$ref": "#/$defs/vector3" },
				"Idle": { "$ref": "#/$defs/ray3d" },
				"Select": { "$ref": "#/$defs/ray3d" },
				"ShowCore": {
					"description": "Whether the core is visible on the mountain while this chapter is selected.",
					"type": "boolean"
				},
				"State": {
					"default": 0,
					"type": "number"
				},
				"Zoom": { "$ref": "#/$defs/ray3d" }
			},
			"type": "object"
		},

		"OverrideASideMeta": {
			"description": "Whether to override the metadata of the A side. Only applicable to B- and C-sides.",
			"type": "boolean"
		},

		"TitleAccentColor": {
			"description": "Accent color for chapter card in the menu.",
			"type": "string"
		},

		"TitleBaseColor": {
			"description": "Base color for chapter card in the menu.",
			"type": "string"
		},

		"TitleTextColor": {
			"description": "Text color for chapter card in the menu.",
			"type": "string"
		},

		"Wipe": {
			"anyOf": [
				{
					"enum": [
						"Celeste.CurtainWipe",
						"Celeste.AngledWipe",
						"Celeste.DreamWipe",
						"Celeste.KeyDoorWipe",
						"Celeste.WindWipe",
						"Celeste.DropWipe",
						"Celeste.FallWipe",
						"Celeste.MountainWipe",
						"Celeste.HeartWipe",
						"Celeste.StarfieldWipe"
					]
				},
				{ "type": "string" }
			],
			"description": "Death effect that appears when the player dies.",
			"type": "string"
		}
	},

	"title": "Everest Map Metadata Schema",
	"type": "object"
}
